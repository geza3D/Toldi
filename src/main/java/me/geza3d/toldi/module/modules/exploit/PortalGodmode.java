package me.geza3d.toldi.module.modules.exploit;

import me.geza3d.toldi.events.JoinLeaveCallback;
import me.geza3d.toldi.events.PacketCallback;
import me.geza3d.toldi.module.EnumModuleType;
import me.geza3d.toldi.module.ToldiModule;
import net.minecraft.network.packet.c2s.play.TeleportConfirmC2SPacket;
import net.minecraft.util.ActionResult;

@ToldiModule.Type(EnumModuleType.EXPLOIT)
public class PortalGodmode extends ToldiModule {

	TeleportConfirmC2SPacket packet = null;
	
	@Override
	public void disable() {
		if(getPlayer() != null && packet != null) {
			getMC().world.sendPacket(packet);
		}
		super.disable();
	}
	
	@Listener
	public void onLeave() {
		JoinLeaveCallback.LEAVE.register(() -> {
			if(getStatus()) {
				disable();
			}
			return ActionResult.SUCCESS;
		});
	}
	
	@Listener
	public void onPacketSent() {
		PacketCallback.OUT.register(packet -> {
			if(getStatus()) {
				if(packet instanceof TeleportConfirmC2SPacket && getPlayer().hasNetherPortalCooldown()) {
					this.packet = (TeleportConfirmC2SPacket) packet;
					return ActionResult.FAIL;
				}
			}
			return ActionResult.SUCCESS;
		});
	}
}
